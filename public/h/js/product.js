var newProduct={};newProduct.PictureView=function(e){this.pattern=e.pattern||1,this.proType=e.proType||1,this.modelEle=e.modelEle,this.picEle=e.picEle,this.modelImgArr=e.modelArr||[],this.modelBtn=e.modelBtn,this.modelTurnBtn=e.modelTurnBtn,this.modelPicEle=null,this.modelIndex=e.modelIndex||6,this.modelCon=e.modelCon,this.picImgArr=e.picImgArr||[],this.picArr=[],this.picIndex=e.picIndex||0,this.picBtn=e.picBtn,this.picLargeEle=null,this.picLargeCon=e.picLargeCon,this.picSelectClass=e.picSelectClass,this.picSmallCon=e.picSmallCon},newProduct.PictureView.prototype={constructor:newProduct.PictureView,changeToPic:function(){this.modelEle.hide(),this.picEle.show()},changeToModel:function(){this.modelEle.show(),this.picEle.hide()},fillModelImg:function(e){var t=this;t.modelImgArr=e,t.modelPicEle.attr("src",t.modelImgArr[t.modelIndex])},fillPicImg:function(e){var t=this;t.picLargeEle.attr("src",e)},changPic:function(e){this.picArr[this.picIndex].active=!1,this.picArr[this.picIndex].changeState(),this.picIndex=e.index,this.picLargeEle.attr("src",e.largeImg)},turnPic:function(e){var t=this,i=t.modelImgArr.length;t.modelIndex=e>0?(t.modelIndex-1+i)%i:(t.modelIndex+1)%i,t.modelPicEle.attr("src",t.modelImgArr[t.modelIndex])},init:function(){var e,t=this,i="object"==typeof t.modelEle.onmousewheel?"mousewheel":"wheel";t.picLargeEle=$('<img src="'+t.picImgArr[t.picIndex].largeImg+'"/>'),t.picLargeEle.prependTo(t.picLargeCon);for(var s=0;s<t.picImgArr.length;s++)e=new newProduct.PicClass({index:s,picView:t,largeImg:t.picImgArr[s].largeImg,smallImg:t.picImgArr[s].smallImg,selectClass:t.picSelectClass,active:t.picIndex==s?!0:!1}),e.picEle.appendTo(t.picSmallCon),t.picArr.push(e);1==t.proType&&(t.modelPicEle=$('<img src="'+t.modelImgArr[t.modelIndex]+'"/>'),t.modelPicEle.prependTo(t.modelCon),2==t.pattern&&t.changeToModel(),t.modelBtn.click(function(){t.changeToPic()}),t.picBtn.click(function(){t.changeToModel()}),t.modelPicEle.on(i,function(e){var i=e.originalEvent.wheelDelta||e.originalEvent.deltaY;return t.turnPic(i),!1}),t.modelTurnBtn.click(function(){t.turnPic(1)}))}},newProduct.PicClass=function(e){this.index=e.index,this.picView=e.picView,this.largeImg=e.largeImg,this.smallImg=e.smallImg,this.selectClass=e.selectClass,this.active=e.active,this.picEle=null,this.init()},newProduct.PicClass.prototype={constructor:newProduct.PicClass,changeState:function(){this.active?this.setActive():this.cancelActive()},setActive:function(){var e=this;e.picEle.addClass(e.selectClass)},cancelActive:function(){var e=this;e.picEle.removeClass(e.selectClass)},changeView:function(){var e=this;e.picView.changPic(e)},init:function(){var e=this;e.picEle=$('<li><img src="'+e.smallImg+'"/></li>'),e.picEle.click(function(){e.changeView(),e.active=!0,e.changeState()}),e.changeState()}},newProduct.Specs=function(e){this.storeData=e.storeData,this.dimensionArr=[],this.selectArr=[],this.dimensionCon=e.con,this.selectClass=e.selectClass,this.disableClass=e.disableClass,this.disableSelectClass=e.disableSelectClass,this.chooseData=null,this.selectCallback=e.selectCallback},newProduct.Specs.prototype={constructor:newProduct.Specss,checkStore:function(){for(var e,t,i,s=0;s<this.dimensionArr.length;s++){t=this.dimensionArr[s];for(var a=0;a<t.detailArr.length;a++){i=t.detailArr[a];for(var l=0;l<this.storeData.length;l++){e=!0;for(var n=0;n<this.storeData[l].specs.length&&e;n++)for(var c=0;c<this.selectArr.length;c++)if(this.selectArr[c].dimensionId==this.storeData[l].specs[n].specsCateId){if(t.dimensionId==this.storeData[l].specs[n].specsCateId){if(i.detailId!=this.storeData[l].specs[n].specsId){e=!1;break}i.detailId==this.selectArr[c].detailId&&(this.chooseData=this.storeData[l],i.jpName&&(this.chooseData.jpName=i.jpName))}else if(this.selectArr[c].detailId!=this.storeData[l].specs[n].specsId){e=!1;break}break}if(e){i.judgeState(this.storeData[l].storeStatus);break}}i.confirmState()}}},resetSelect:function(e){for(var t,i,s=this,a=this.storeData,l=!1,n=0;n<s.selectArr.length;n++)if(s.selectArr[n].dimensionId==e.dimensionId){s.selectArr[n].detailId=e.selectDetail.detailId;break}if(e.selectDetail.parent&&e.selectDetail.nomod){for(var c=this.dimensionArr[0].dimensionId,r=0;r<this.selectArr.length;r++)this.selectArr[r].dimensionId===c?i=this.selectArr[r].detailId:1===r&&(t=this.selectArr[r].detailId);for(var o=0;o<a.length;o++)2==a[o].specs.length&&(i===a[o].specs[0].specsId||i===a[o].specs[1].specsId)&&(t===a[o].specs[0].specsId||t===a[o].specs[1].specsId)&&0===a[o].storeStatus&&(l=!0);for(var d=0;d<a.length;d++)if(2==a[d].specs.length&&(i===a[d].specs[0].specsId||i===a[d].specs[1].specsId)&&1===a[d].storeStatus)for(var p=0;p<s.dimensionArr[1].detailArr.length;p++)for(var h=s.dimensionArr[1].detailArr[p],m=0;m<a[d].specs.length;m++)if(h.detailId===a[d].specs[m].specsId&&l)return void h.dimensionObj.changeSelect(h)}},changeHandle:function(e){var t=this;t.resetSelect(e,this),t.checkStore(),t.selectCallback&&t.selectCallback(e)},setDes:function(){for(var e=this,t=e.selectArr,i=0;i<t.length;i++)for(var s=0;s<e.dimensionArr.length;s++)if(t[i].dimensionId==e.dimensionArr[s].dimensionId)for(var a=0;a<e.dimensionArr[s].detailArr.length;a++)t[i].detailId==e.dimensionArr[s].detailArr[a].detailId&&(e.dimensionArr[s].resetChild(e.dimensionArr[s].detailArr[a]),e.resetSelect(e.dimensionArr[s]));e.checkStore()},fileSelect:function(e){this.selectArr=[];for(var t=0;t<e.length;t++)this.selectArr.push({dimensionId:e[t].specsCateId,detailId:e[t].specsId})},fileDimension:function(e,t){var i=t||this.dimensionCon;this.dimensionArr.push(e),i.append(e.ele)}},newProduct.Dimension=function(e){e=e||{},this.dimensionId=e.dimensionId,this.name=e.name,this.type=e.type,this.specsType=e.specsType,this.specsObj=e.specsObj,this.selectDetail=null,this.detailArr=[],this.ele=e.ele||$('<li class="specs-dimension clearfix"><span>'+e.name+"</span><div><ul></ul></div></li>"),this.detailCon=this.ele.find("ul")},newProduct.Dimension.prototype={constructor:newProduct.Dimension,resetChild:function(e){var t=this;t.selectDetail&&this.selectDetail.cancelActive(),t.selectDetail=e,t.selectDetail.setActive()},changeSelect:function(e){var t=this;t.resetChild(e),t.specsObj.changeHandle(t)},fileDetail:function(e){this.detailArr.push(e),this.detailCon.append(e.ele)}},newProduct.SpecsDetail=function(e){e=e||{},this.detailId=e.detailId,this.des=e.des,this.specsImg=e.specsImg,this.dimensionObj=e.dimensionObj,this.selectState=e.selectState||!1,this.disableState=!1,this.stateClass=null,this.selectClass=e.selectClass,this.disableClass=e.disableClass,this.disableSelectClass=e.disableSelectClass,this.materialImg=e.materialImg,this.materialSale=e.materialSale,this.ele=e.ele,this.parent=e.parent,this.nomod=e.nomod||!1;var t="";e.parent&&void 0!==e.display&&(t=e.display?"":'style="display:none"'),!e.ele&&this.dimensionObj&&1==this.dimensionObj.type?this.ele=$('<li parent="'+e.parent+'" nomod="'+e.nomod+'" '+t+'><img src="'+e.specsImg+'" alt="" /><em></em></li>'):e.ele||(this.ele=$('<li class="specs-detail" parent="'+e.parent+'" nomod="'+e.nomod+'" '+t+">"+e.des+"<em></em></li>")),this.addHandel()},newProduct.SpecsDetail.prototype={constructor:newProduct.SpecsDetail,judgeState:function(e){this.disableState=1==e?!1:!0},cancelActive:function(){this.selectState=!1},setActive:function(){this.selectState=!0},confirmState:function(){var e=this;e.stateClass&&e.ele.removeClass(e.stateClass),e.stateClass=e.selectState&&e.disableState?e.disableSelectClass:e.selectState?e.selectClass:e.disableState?e.disableClass:null,e.stateClass&&e.ele.addClass(e.stateClass)},setMaterial:function(){var e=this;e.ele.append("<i></i>"),e.ele.append(e.materialSale?'<div><img src="'+e.materialImg+'"/><b>'+e.des+"</b><p>"+e.materialSale+"</p></div>":'<div class="material-sale">'+e.des+"</div>"),e.ele.append(e.materialEle),e.ele.on("mouseenter",function(){e.ele.find("i,div").show()}),e.ele.on("mouseleave",function(){e.ele.find("i,div").hide()})},addHandel:function(){var e=this;e.ele.click(function(){!e.selectState&&e.dimensionObj.changeSelect(e)})}},newProduct.ShopCar=function(e){this.type=null,this.addShopCarEle=e.addShopCarEle,this.addShopCarUrl=e.addShopCarUrl,this.buyNowEle=e.buyNowEle,this.buyNowUrl=e.buyNowUrl,this.desableClass=e.desableClass,this.priceEle=e.priceEle,this.durationEle=e.durationEle,this.num=e.num||1,this.addEle=e.addEle,this.numEle=e.numEle,this.minusEle=e.minusEle,this.getParamsFn=e.getParamsFn,this.considerObj={},this.price=0,this.duration=0,this.canSend=1},newProduct.ShopCar.prototype={constructor:newProduct.ShopCar,addNum:function(){this.num<99&&this.num++},minusNum:function(){this.num>1&&this.num--},setConsider:function(e){for(var t in e)!this.considerObj[t]&&(this.considerObj[t]={}),this.considerObj[t].price=parseFloat(e[t].price),this.considerObj[t].duration=parseFloat(e[t].duration);this.recalculate()},recalculate:function(){var e=this;e.price=e.duration=0;for(var t in e.considerObj)e.price+=e.considerObj[t].price,e.duration+=e.considerObj[t].duration;e.durationEle.html(e.duration),e.priceEle.html(e.price)},setDesabel:function(){var e=this;e.addShopCarEle.addClass(e.desableClass),e.buyNowEle.addClass(e.desableClass),e.canSend=0},setAble:function(){var e=this;e.addShopCarEle.removeClass(e.desableClass),e.buyNowEle.removeClass(e.desableClass),e.canSend=1},sendRequest:function(){var e=this;opt=e.getParamsFn(),site="http://buy.biyao.com",url=1==e.type?e.addShopCarUrl:e.buyNowUrl,e.canSend&&opt&&(e.canSend=0,$.ajax({type:"POST",url:site+url,data:opt,async:!1,cache:!1,dataType:"jsonp",success:function(t){return 205017==t?void LT.alertSmall("原材料库存不足"):t?void(1==e.type?window.location.href=site+"/shopcars/index.html":2==e.type&&(window.location.href=site+"/orders/confirmOrderByShopCar")):void LT.alertSmall("购买失败")},error:function(){LT.alertSmall("网络异常，购买失败")},complete:function(){e.canSend=1}}))},init:function(){var e=this;e.addShopCarEle.click(function(){e.type=1,e.sendRequest()}),window.iframeCallBack=function(){e.buyNowEle.click()},e.buyNowEle.click(function(){LT.temp.loginFn.islogin_dialog(!0)&&(e.type=2,e.sendRequest())}),e.addEle.click(function(){e.addNum(),e.numEle.html(e.num)}),e.minusEle.click(function(){e.minusNum(),e.numEle.html(e.num)})}},newProduct.Carve=function(e){this.sleepEle=e.sleepEle,this.downEle=e.downEle,this.activeEle=e.activeEle,this.upEle=e.upEle,this.carveArr=[]},newProduct.Carve.prototype={constructor:newProduct.Carve,setDown:function(){this.sleepEle.hide(),this.activeEle.slideDown(200)},setUp:function(){this.activeEle.slideUp(200),this.sleepEle.show()},addCarve:function(e){var t=this;t.carveArr.push(e),e.carveEle.attr({maxlength:e.maxLength,placeholder:e.placeHoder}),e.centainBtn.click(function(){for(var t,i="",s=0;s<e.carveEle.length;s++)$(e.carveEle[s]).val()&&(i+=$.trim($(e.carveEle[s]).val())+";");i&&(i=i.slice(0,-1)),t=e.validFn(i,e.content),t&&(e.content=i,e.successFn&&e.successFn(e))})},init:function(){var e=this;e.downEle.click(function(){e.setDown()}),e.upEle.click(function(){e.setUp()})}},masterGuy.categoryBarScroll(0),masterGuy.rightBarPos(550),$(function(){var e=0,t=1,i=1,s=$(".eval-list"),a=$("#moreProduct"),l={productId:newProduct.designData.productId,haveImage:0,pageSize:20,pageIndex:1},n=function(e,t){var i=t-e,s=parseInt(i/1e3),a=parseInt(s/60),l=parseInt(a/60),n=parseInt(l/24),c=parseInt(n/30),r=parseInt(c/12);return r?r+"年":c?c+"个月":n?n+"天":l?l+"小时":a?a+"分钟":s+"秒"},c=function(e){var t=/\<|\>|\"|\'|\&/g;return e=e.replace(t,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;"}})},r=function(e,t){var i=function(e,t){this.smallCon=e,this.largeCon=t,this.smallActiveClass="imgSmall-active",this.largeActiveTime=300,this.btnHideClass="eval-extreme",this.largeShowClass="eval-imgLarge-show",this.leftBtn=t.find(".eval-leftBtn"),this.rightBtn=t.find(".eval-rightBtn"),this.closeBtn=t.find(".eval-close"),this.index=0,this.openState=!1,this.picArr=[]};i.prototype={constructor:i,activePic:function(e){var t=this;if(t.openState){if(t.index==e)return}else t.expand();t.picArr[t.index].largePic.fadeOut(),t.picArr[t.index].smallPic.removeClass(t.smallActiveClass),t.index=e,t.picArr[t.index].largePic.fadeIn(),t.picArr[t.index].smallPic.addClass(t.smallActiveClass),t.calculateExtreme()},calculateExtreme:function(){var e=this;e.leftBtn.removeClass(e.btnHideClass),e.rightBtn.removeClass(e.btnHideClass),e.index==e.picArr.length-1&&e.rightBtn.addClass(e.btnHideClass),0==e.index&&e.leftBtn.addClass(e.btnHideClass)},packUp:function(){var e=this;e.openState=!1,e.largeCon.removeClass(e.largeShowClass),e.picArr[e.index].largePic.fadeOut(),e.picArr[e.index].smallPic.removeClass(e.smallActiveClass)},expand:function(){var e=this;e.openState=!0,e.largeCon.addClass(e.largeShowClass)},init:function(){for(var e=this,t=0;t<e.smallCon.find("li").length;t++)e.picArr[t]={smallPic:$(e.smallCon.find("li")[t]),largePic:$(e.largeCon.find("li")[t]),index:t},e.picArr[t].smallPic.click(function(t){return function(){e.activePic(t)}}(t));e.leftBtn.click(function(){e.activePic(e.index-1)}),e.rightBtn.click(function(){e.activePic(e.index+1)}),e.closeBtn.click(function(){e.packUp()})}},new i(e,t).init()},o=function(e){{var t,i,s,a,l,o,d,p;$(".eval-list")}switch(t=$("<li></li>"),s=$('<dl class="eval-user"><dt><img src="'+(e.nickIcon||"http://static1.biyao.com/pc/common/img/master/admin.png")+'"/></dt><dd>'+e.nickname+"</dd></dl>"),i=$('<dl class="eval-score"></dl>'),e.score){case 1:i.append('<dt class="eval-bad"></dt><dd>差评</dd>');break;case 2:i.append('<dt class="eval-bad"></dt><dd>差评</dd>');break;case 3:i.append('<dt class="eval-normal"></dt><dd>中评</dd>');break;case 4:i.append('<dt class="eval-good"></dt><dd>好评</dd>');break;case 5:i.append('<dt class="eval-good"></dt><dd>好评</dd>')}if(a=$('<div class="eval-content"><p class="eval-artical">'+c(e.content)+"</p></div>"),e.imageList.length){l=$('<ul class="eval-imgSmall"></ul>'),o=$('<div class="eval-imgLarge"><ul></ul><span class="eval-leftBtn"></span><span class="eval-rightBtn"></span><i class="eval-close"></i></div>');for(var h=0;h<e.imageList.length;h++)d=e.imageList[h].slice(0,e.imageList[h].lastIndexOf(".")),p=e.imageList[h].slice(e.imageList[h].lastIndexOf(".")),l.append(e.imageList[h].indexOf("bfs")>=0?'<li><img src="'+d+"_128x128"+p+'"/></li>':'<li><img src="'+d+"_128"+p+'"/></li>'),o.find("ul").append('<li><img src="'+e.imageList[h]+'"/></li>');a.append(l).append(o),r(l,o)}if(a.append('<p class="eval-time"><span>'+new Date(Number(e.evalTime)).format("yyyy-MM-dd hh:mm")+"&nbsp;&nbsp;</span><span>"+e.sizeName.replace("; ","</span><span>")+"</span></p>"),e.reEvalList.length)for(var m=0;m<e.reEvalList.length;m++)switch(e.reEvalList[m].evalType){case 10:a.append('<dl class="eval-reply"><dt>用户'+n(e.evalTime,e.reEvalList[m].evalTime)+"后追评：</dt><dd>"+c(e.reEvalList[m].content)+"</dd></dl>");break;case 20:a.append('<dl class="eval-sup"><dt>商家回复：</dt><dd>'+c(e.reEvalList[m].content)+"</dd></dl>");break;case 30:a.append('<dl class="eval-sup"><dt>平台回复：</dt><dd>'+c(e.reEvalList[m].content)+"</dd></dl>")}return t.append(s,i,a),t},d=function(){i&&(i=0,$.ajax({type:"POST",url:window.ControllerSite+"/products/getComment",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",data:l,success:function(e){if(e.success&&e.data.commentList.length){for(var t=0;t<e.data.commentList.length;t++)s.append(o(e.data.commentList[t]));1==e.data.pageIndex&&a.css("display","block"),e.data.pageIndex>=e.data.pageCount?(a.hide(),s.append('<li class="eval-noMore">没有更多评论了</li>')):i=1,l.pageIndex++}else s.html('<li class="eval-noComment">暂无评论</li>')}}))};$("#detail").click(function(){e&&(e=0,$("#evaluate").removeClass("view-active"),$(".view-evaluate").hide(),$("#detail").addClass("view-active"),$(".view-detail").show(),h&&$("body, html").animate({scrollTop:m},400))}),$("#evaluate").click(function(){e||(e=1,$("#evaluate").addClass("view-active"),$(".view-evaluate").show(),$("#detail").removeClass("view-active"),$(".view-detail").hide(),h&&$("body, html").animate({scrollTop:m},400))}),$("#evalAll").click(function(){t||(t=1,$("#evalAll").addClass("eval-active"),$("#evalImage").removeClass("eval-active"),l.pageIndex=1,l.haveImage=0,a.hide(),s.empty(),i=1,d())}),$("#evalImage").click(function(){t&&(t=0,$("#evalImage").addClass("eval-active"),$("#evalAll").removeClass("eval-active"),l.pageIndex=1,l.haveImage=1,a.hide(),s.empty(),i=1,d())}),$.ajax({type:"POST",url:window.ControllerSite+"/products/allRating",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",data:{modelid:newProduct.designData.productId},success:function(e){1==e.success&&($("#evalScore").html(e.data.avg_socre.toFixed(1)+"分"),$("#evaluate").html("评价详情 "+e.data.comment_count+"<i></i>"))}}),$(window).on("scroll",function(){($("body").scrollTop()||document.documentElement.scrollTop)-a.offset().top+$(window).height()>=0&&e&&i&&d()}),d();var p=$(".view-title"),h=!1,m=p.offset().top,u=m+50;$(window).on("scroll",function(){$("body").scrollTop()>=u||document.documentElement.scrollTop>=u?h||(h=!0,p.addClass("view-retract").animate({top:0},200)):(0!=$("body").scrollTop()&&$("body").scrollTop()<=m||0!=document.documentElement.scrollTop&&document.documentElement.scrollTop<=m||0==$("body").scrollTop()&&0==document.documentElement.scrollTop)&&h&&(h=!1,p.stop().removeAttr("style").removeClass("view-retract"))}),$(".view-shopCar").click(function(){$("body, html").animate({scrollTop:0},400)}),1==newProduct.designData.supplierInfo.isZcwebim?masterGuy.rightBarServe(newProduct.serveLink):masterGuy.rightBarPhone(newProduct.designData.supplierInfo.servicesTel);var v,f=[],g=function(){for(var e,t=window.location.search.slice(1).split("&"),i=0;i<t.length;i++)"ass"==t[i].split("=")[0]&&(e=t[i].split("=")[1]);return e?decodeURIComponent(e):e}();g&&(f.push({pclk:"search_show.result.product",pclkp:g,pn:"pdetail",pnp:"suid="+newProduct.designData.suData.suId}),v=masterGuy.assemblyParam(f),masterGuy.setData(v,function(){}))});