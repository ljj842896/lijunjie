var newsPath="http://extendw.biyao.com",classifyGuy={setItem:function(e){var t,a;return t=$("<li></li>"),a=$('<a target="_blank" href="'+ControllerSite+"/products/"+e.suId+'-0.html"><i><img src="'+e.imageUrl+'"/></i></a>'),Number(e.isShowIcon)&&a.append("<b>新品</b>"),a.append("<dl><dt>"+(e.title||e.shortName)+"</dt><dd>¥"+e.price+"</dd></dl>"),a.prependTo(t),t},getMore:function(e){var t=e.moreEle,a=1,n=function(){a=0,$.ajax({type:"get",url:e.url,data:e.params,contentType:"application/json",dataType:e.dataType||"json",jsonpCallback:e.jsonpCallback||null,success:function(n){n.success?(e.params.pageIndex++,e.callback(n),e.showMoreEle(n)?t.remove():a=1):t.html(n.error.message)},error:function(){t.html("网络请求失败！")}})};t.length&&$(window).on("scroll",function(){($("body").scrollTop()||document.documentElement.scrollTop)-t.offset().top+$(window).height()>=0&&a&&n()})},search:function(){var e=this,t=$(".category-list"),a=function(){for(var e,t=window.location.search.slice(1).split("&"),a=0;a<t.length;a++)"query"==t[a].split("=")[0]&&(e=t[a].split("=")[1]);return decodeURIComponent(e)}(),n=function(e){var t,n;return pclkpStr=encodeURIComponent("pos="+encodeURIComponent(e.position)+"&sid="+encodeURIComponent(o.sid)+"&q="+a),t=$("<li></li>"),n=$('<a target="_blank" href="'+ControllerSite+"/products/"+e.suId+"-0.html?ass="+pclkpStr+'"><i><img src="'+e.image+'"/></i></a>'),n.append("<dl><dt>"+e.name+"</dt><dd>¥"+e.price+"</dd></dl>"),n.prependTo(t),t},o={sid:"",pvid:"",ubid:"3-"+(new Date).getTime()+"-"+cipher($.cookie("uuid")).substring(0,16),platform:"pc",uuid:$.cookie("uuid")||masterGuy.randomStr(36),uid:$.cookie("uid")||"",appVersion:"",device:"",osVersion:"",deviceWidth:window.screen.width,deviceHeight:window.screen.height,query:a,pageIndex:1},c=function(e,t){return e.length>t?e.slice(0,t)+"...":e},r=function(e){var t=/\<|\>|\"|\'|\&/g;return e=e.replace(t,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"&":return"&amp;"}})};$("#searchInput").val(decodeURIComponent(a)),$.ajax({url:window.ControllerSite+"/classify/goSearch",type:"POST",data:o,success:function(i){if(1==i.success){o.sid=i.data.sid,o.pageIndex++;for(var s=0;s<i.data.products.length;s++)t.append(n(i.data.products[s]));300==i.data.resultType?$(".search-noResult").show().find("dt").html("您寻找的“"+c(r(decodeURIComponent(a)),10)+"”还未上架"):($(".bread").append("<span><b>&gt;</b>"+c(r(decodeURIComponent(a)),10)+"</span>"),$(".cateBread").append("根据您搜索的“"+c(r(decodeURIComponent(a)),10)+"”，为您匹配到以下商品："),$(".search-result").show()),i.data.pageCount>1&&($(".category-container > li").append('<span id="moreProduct">下拉加载更多</span>'),e.getMore({moreEle:$("#moreProduct"),url:"/classify/goSearch",params:o,callback:function(e){for(var a=0;a<e.data.products.length;a++)t.append(n(e.data.products[a]))},showMoreEle:function(e){return e.data.pageIndex>=e.data.pageCount}}))}}})},category:function(){var e=this;e.categoryId!=e.intoId&&$("#"+e.intoId).length&&$("body").scrollTop($("#"+e.intoId).offset().top-60)&&(document.documentElement.scrollTop=$("#"+e.intoId).offset().top-60),$(".cateBread li").click(function(){var e=$(this).attr("class");classifyGuy.parentCategoryName?$("body").scrollTop($("#"+e).offset().top-60)&&(document.documentElement.scrollTop=$("#"+e).offset().top-60):window.location=ControllerSite+"/classify/category.html?categoryId="+e})},newMore:function(){var e,t,a,n,o=$("#moreProduct"),c=$(".newProduct ul"),r=1,i=0;$(window).on("scroll",function(){if(($("body").scrollTop()||document.documentElement.scrollTop)-o.offset().top+$(window).height()>=0&&r){r=0;for(var s=c.find("li").length;s<=classifyGuy.newProList.length&&!(i>=9);s++){e=classifyGuy.newProList[s-1],c.find("li").eq(s-1).find("a").length?t=c.find("li").eq(s-1):(t=$('<li><div class="new-title"><b>'+e.saleTime+"</b></div></li>"),t.appendTo(c));for(var l=c.find("li").eq(s-1).find("a").length;l<e.item.length&&!(i>=9);l++)i++,a=e.item[l],n=$('<a target="_blank" href="'+ControllerSite+"/products/"+a.suId+'-0.html"><img src="'+a.imageUrl+'"/></a>'),n.prepend("<dl><dt><h2>"+a.title+"</h2><h3>¥"+a.price+"</h3></dt><dd>"+a.salePoint+"</dd></dl>"),n.appendTo(t)}s>classifyGuy.newProList.length&&o.remove(),r=1,i=0}})},resetCate:function(){$.ajax({type:"get",url:ControllerSite+"/home/getCategoryTree",data:"",contentType:"application/json",dataType:"jsonp",jsonpCallback:"getCateTree",success:function(e){if(1==e.success){var t,a,n,o,c,r,i,s,l;$(".nav-list").empty();for(var d=0;d<e.data.length;d++){r=e.data[d],t=$('<li class="nav-main"></li>'),c=$("<p></p>"),a=$("<ul></ul>");for(var p=0;p<r.categoryGroup.length;p++)i=r.categoryGroup[p],i.categoryName=i.categoryName.length>4?i.categoryName.slice(0,4):i.categoryName,0!=p&&c.append("<span>/</span>"),c.append('<a href="'+ControllerSite+"/classify/category.html?categoryId="+i.categoryId+'">'+i.categoryName+"</a>");t.append(c);for(var u=0;u<r.subCategoryList.length;u++){s=r.subCategoryList[u],s.categoryName=s.categoryName.length>8?s.categoryName.slice(0,8):s.categoryName,n=$('<li class="nav-sub clearfix"><a href="'+ControllerSite+"/classify/category.html?categoryId="+s.categoryId+'">'+s.categoryName+"</a><i>&gt;</i></li>"),o=$("<ul></ul>");for(var m=0;m<s.subCategoryList.length;m++)l=s.subCategoryList[m],l.categoryName=l.categoryName.length>12?l.categoryName.slice(0,12):l.categoryName,o.append('<li class="nav-item"><a href="'+ControllerSite+"/classify/category.html?categoryId="+l.categoryId+'">'+l.categoryName+"</a></li>");n.append(o),a.append(n)}t.append(a),$(".nav-list").append(t)}}}})},articleDetail:function(e){var t=$("#moreComment"),a=$(".article-comments ul"),n=$(".article-more"),o=1,c={pageSize:10,pageIndex:1,articleId:e},r=function(){o=0,$.ajax({type:"get",url:newsPath+"/article/getMoreComments",data:c,contentType:"application/json",dataType:"jsonp",jsonpCallback:"commenData",success:function(e){if(e.success){for(var n,r,i,s=0;s<e.data.commentList.length;s++)r=e.data.commentList[s],i=r.headPortraitUrl||"http://static.biyao.com/pc/common/img/master/admin.png",n=$('<li><span><img src="'+i+'" alt="" /></span></li>'),n.append("<div><span>"+r.nickname+"</span><i>"+r.commentDate+"</i></div>"),n.append("<p>"+r.content+"</p>").appendTo(a);$(".comments-publish b i").html(e.data.commentCount),c.pageIndex>=e.data.pageCount?t.remove():o=1,0==e.data.commentCount&&a.html("<li><p>暂时没有评论！</p></li>"),c.pageIndex++}else t.html(e.error.message)},error:function(){t.html("网络请求失败！")}})},i=function(){$.ajax({type:"get",url:newsPath+"/article/getMoreArticle",data:{pageSize:3,pageIndex:1,articleId:e},contentType:"application/json",dataType:"jsonp",jsonpCallback:"byJsonp",success:function(e){if(e.success){for(var t,a,o=0;o<e.data.list.length;o++)a=e.data.list[o],t=$('<li><img src="'+a.pcCoverImageUrl+'" alt=""/><dl><dt><a target="_blank" href="'+a.pcLink+'">'+a.title+"</a></dt><dd>"+a.author+"&nbsp;&nbsp;&nbsp;&nbsp;"+a.statusUpdateTime+"</dd></dl></li>"),2>o&&n.find("ul").append(t);!e.data.list.length&&n.remove()}else n.remove()},error:function(){n.remove()}})},s=function(){$.ajax({type:"get",url:newsPath+"/article/addReadNum",data:{articleId:e},contentType:"application/json",dataType:"jsonp",jsonpCallback:"addReadNum",success:function(){l()}})},l=function(){$.ajax({type:"get",url:newsPath+"/article/getReadNum",data:{articleId:e},contentType:"application/json",dataType:"jsonp",jsonpCallback:"getReadNum",success:function(e){e.success&&$(".article-readNum span").html(e.data.readingNumber>=1e5?"100000+":e.data.readingNumber)}})};s(),i(),t.length&&$(window).on("scroll",function(){($("body").scrollTop()||document.documentElement.scrollTop)-t.offset().top+$(window).height()>=0&&o&&r()});var d=0;window.iframeCallBack=function(){masterGuy.getLoginData(),masterGuy.getShopCarData(),$(document).find("#commitBtn").click(),$(document).find(".pop_close").click()},$("#commentsArea").on("focus",function(){$(this).addClass("focus"),$(".comments-publish p i").css("display","block")}).on("blur",function(){setTimeout(function(){$("#commentsArea").removeClass("focus"),$(".comments-publish p i").hide()},300)}).on("input",function(){$(this).val().length?($("#commitBtn").css("background","#523669"),d=1):($("#commitBtn").css("background","#ccc"),d=0)}),$("#commitBtn").on("click",function(){d&&LT.temp.loginFn.islogin_dialog(!0)&&$.ajax({type:"get",url:ControllerSite+"/account/checkAccountStateJsonp",data:"",contentType:"application/json",dataType:"jsonp",jsonpCallback:"getBindStatus",success:function(t){1==t.success?1==t.data.isBindPhone||1==t.data.isRelation?$.ajax({type:"get",url:newsPath+"/article/commitComment",data:{articleId:e,commentContent:encodeURI($("#commentsArea").val())},contentType:"application/json",dataType:"jsonp",jsonpCallback:"byJsonp",success:function(e){e.success&&($("#commentsArea").val(""),$("#commitBtn").css("background","#ccc"),d=0,a.empty(),c.pageIndex=1,r())}}):LT.confirmDia("根据国家相关法律对于账号实名的要求，操作前需要完成手机绑定。",function(){window.location=window.ControllerSite+"/MyCenter/ChangePhone.html"},{cancelCallback:function(){},btnText:["去绑定手机","取消"],className:"w90 mg_l5"}):LT.alertSmall(t.error.message)},error:function(){LT.alertSmall("网络请求失败，请稍后再试！")}})})}};