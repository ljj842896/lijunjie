!function(e){"use strict";function r(){return""==$.trim(v.val())?(r.sendError(y.phoneNull),!1):w.test(v.val())?!0:(r.sendError(y.phoneError),!1)}function o(){return""==$.trim(p.val())?(o.sendError(y.smsNull),!1):C.test(p.val())?!0:(o.sendError(y.smsError),!1)}var s={},t=e.getReturnUrl(),n={model:"pwd",args:{k:null,phone:0,smsCode:0}},a=$("#userName").siblings("i.account-error");e.BYplaceholder({userName:"请输入手机号",password:"请输入登录密码"}),e.BYvalidate.evolutionRole([{roleName:"pwd",roleFn:function(e){var r=/^[0-9]{6,32}$/,o=/^[a-zA-Z]{6,32}$/,s=/[\u4E00-\u9FA5]/,t=/^[@!#\$%&'\*\+\-\/=\?\^_`{\|}\[\]<>\(\)"~,\.:;\\]{6,32}$/,n=/^[0-9a-zA-Z@!#\$%&'\*\+\-\/=\?\^_`{\|}\[\]<>\(\)"~,\.:;\\]{6,32}$/;return!(r.test(e)||o.test(e)||t.test(e)||s.test(e)||!n.test(e))},roleMessage:"登录密码格式错误"},{roleName:"phoneLength",roleFn:function(e){return e.length>=10},roleMessage:"账号格式错误，请重新输入"},{roleName:"phoneOrNum",roleFn:function(e){return 10==e.length?/^\d+$/.test(e):/^(13|14|15|17|18|19)\d{9}$/.test(e)},roleMessage:"手机号格式错误"}]),s.valid=e.BYvalidate.createValid({userName:[{role:"required",message:"请输入手机号"},{role:"phoneLength"},{role:"phoneOrNum"}],password:[{role:"required",message:"请输入登录密码"},{role:"pwd"}],config:{messagePosition:function(e){return e.parents("li").find("i")},messageCallback:function(e,r){e?r.removeClass("input-error"):r.addClass("input-error")}}}),s.promptEle=$(".account-prompt"),s.sCode=null,s.codeEle=$(".account-imgCode"),s.codeInput=$("#imgCode"),s.rememberState=0,s.rememberEle=$(".login-auto span"),s.rememberEle.click(function(){s.rememberEle.html(s.rememberState%2?"<b></b>下次自动登录":'<b class="login-remember"></b>请勿在公用电脑上勾选此选项'),s.rememberState++}),s.commitBtn=$(".account-btn"),s.committing=0,s.params=null,s.commitAction,s.commitBtn.click(function(){s.commitAction()});s.commitAction=function(){s.committing%2||!s.valid.valid()||(s.params={userName:$("#userName").val(),password:encodeURIComponent($("#password").val())},s.params.rememberMe=s.rememberState%2?!0:!1,s.sCode&&(s.params.s=s.sCode),s.promptEle.html(""),shumei.onLoad(),$(".qrcodeDivBox").removeClass("_hide"))},$(window).on("keydown",function(e){if(13==e.keyCode||13==e.which)switch(n.model){case"pwd":s.commitAction();break;case"sms":n.smsAction()}});var i=$("div.account-main"),c=i.children("ul"),l=c.eq(1),d=i.children("h4.account-title"),m=d.children("a");m.click(function(){var e=$(this);$(".account-title a").removeClass("active"),e.addClass("active"),e.hasClass("sms_btn")&&(i.children("ul.sms-login").removeClass("hide"),i.children("ul.pwd-login").addClass("hide"),n.model="sms"),e.hasClass("pwd_btn")&&(i.children("ul.pwd-login").removeClass("hide"),i.children("ul.sms-login").addClass("hide"),n.model="pwd")}),e.pwdToSms=function(){$(".sms_btn").addClass("active"),$(".pwd_btn").removeClass("active"),i.children("ul.sms-login").removeClass("hide"),i.children("ul.pwd-login").addClass("hide"),n.model="sms",a.html("")};var u=l.find("li.account-phoneCode>span"),p=l.find("input.sms-code"),h=p.siblings("i.account-error"),v=l.find("input.sms-phone-number"),f=v.siblings("i.account-error"),g=l.children("li.account-sms-btn"),w=/^(13|14|15|17|18|19)\d{9}$/,C=/^\d{6}$/,b=null,k=null,E=!1,y={phoneNull:"请输入手机号",phoneError:"手机号格式错误，请重新输入",smsNull:"请输入短信验证码",smsError:"短信验证码格式错误",notQuerySms:"请输入短信验证码",noMatch:"请输入短信验证码",hasSend:"验证码已发出，请在10分钟内完成输入。",notHaveNumber:function(e){return'手机号未注册过必要，请前往<a class="smssw" href="http://www.biyao.com/account/regist.html?returnUrl=http%3A%2F%2Fwww.biyao.com%2Fhome%2Findex.html&phone='+e+'">注册</a>'}},S=function(){var e=30;E=!0,u.addClass("getSms").text("重新验证(30s)");var r=setInterval(function(){e--,u.text("重新验证("+e+"s)"),0==e&&(clearInterval(r),u.removeClass("getSms").text("获取验证码"),E=!1,e=30)},1e3)};v.on("focus",function(){$(this).removeClass("input-error"),f.text("")}).on("blur",function(){return""==$.trim($(this).val())?void(b=""):(b=r(),void(b&&r.clear()))}),p.on("focus",function(){$(this).removeClass("input-error"),h.text("")}).on("blur",function(){""!=$.trim($(this).val())&&(k=o(),k&&o.clear())}),u.click(function(){E||r()&&(r.clear(),shumei.onLoad(),$(".qrcodeDivBox").removeClass("_hide"))}),r.sendError=function(e,r){r?f.html(e):(v.addClass("input-error"),f.html(e))},r.clear=function(){v.removeClass("input-error"),f.text("")},o.sendError=function(e,r){r?h.html(e):(p.addClass("input-error"),h.text(e))},o.clear=function(){p.removeClass("input-error"),h.text("")},n.smsAction=function(){return r()&&o()?0==n.args.phone?(r.sendError(y.notQuerySms),!1):n.args.phone!=v.val()?(r.sendError(y.noMatch),!1):(o.clear(),r.clear(),n.args.smsCode=p.val(),void $.ajax({url:"/account/smsLogin",type:"post",dataType:"json",data:n.args,success:function(e){if(e.status&&1==e.status)window.location=decodeURIComponent(t);else switch(e.error.code){case"700008":o.sendError(e.error.message);break;case"200002":r.sendError(e.error.message);break;case"700007":o.sendError(e.error.message);break;default:r.sendError(e.error.message)}},error:function(){console.warn("短信登录失败-网络异常")}})):!1},g.click(n.smsAction),$("#qrcodeHide").on("click",function(){$(".qrcodeDivBox").addClass("_hide")}),window.onload=function(){shumei.init({appendTo:"qrcodeDiv",deviceId:SMSdk.getDeviceId(),callback:function(e){e.pass&&setTimeout(function(){$(".qrcodeDivBox").addClass("_hide"),s.committing++;var i=s;"pwd"==n.model&&(s.params.rid=e.rid,s.params.deviceId=SMSdk.getDeviceId(),$.ajax({url:window.ControllerSite+"/account/loginActive",dataType:"json",type:"POST",data:s.params,async:!1,success:function(e){if(1==e.status)window.location=decodeURIComponent(t);else if(e.error&&"208998"==e.error.code)a.css("display","block").html('您的账号存在一定风险，请使用 <a class="smssw" href="javascript:accountGuy.pwdToSms()">短信登录</a>');else try{s.promptEle.html(e.error.message),i.sCode="undefined"==typeof e.error.data.s&&e.error.data.s}catch(r){console.log(r)}s.committing++},error:function(){s.promptEle.html("网络请求失败，请稍后再试"),s.committing++}}),s.params=null,s.params={}),"sms"==n.model&&(s.params={},s.params.rid=e.rid,s.params.deviceId=SMSdk.getDeviceId(),s.params.type="codeLogin",s.params.phone=v.val(),s.params.userName=v.val(),$.ajax({url:"/account/smsCheck",dataType:"json",type:"post",data:s.params,async:!1,success:function(e){if(e.success&&e.k&&(n.args.k=e.k,n.args.phone=v.val(),o.sendError(y.hasSend,!0),E||S()),e.code)switch(e.code){case"208130":o.sendError(e.message);break;case"208103":r.sendError(y.notHaveNumber(v.val()));break;default:r.sendError(e.message)}},error:function(){console.error("短信发送异常")}}),s.params=null,s.params={},s.committing++)},500)}})},$(".account-regist").css("cursor","pointer").click(function(){window.location.href=window.ControllerSite+"/account/regist.html?returnUrl="+t}),$("#findPassword").click(function(){window.location.href=window.ControllerSite+"/account/findPassword.html?returnUrl="+t}),s.paramArr=window.location.search.slice(1).split("&"),$("#thirdWX").click(function(){window.location.href="https://open.weixin.qq.com/connect/qrconnect?appid=wx80d97d6a31aaa448&redirect_uri="+encodeURIComponent("http://www.biyao.com/account/thirdLogin?loginType=3&returnUrl=")+t+"&response_type=code&scope=snsapi_login&state=biyao#wechat_redirect"}),$("#thirdQQ").click(function(){window.location.href="https://graph.qq.com/oauth2.0/authorize?state=biyao&response_type=code&client_id=101235242&redirect_uri="+encodeURIComponent("http://www.biyao.com/account/qqlogin.html?loginType=2&returnUrl=")+t+"&scope=get_user_info"});for(var _=0;_<s.paramArr.length;_++)"mobile"==s.paramArr[_].split("=")[0]&&$("#userName").val(s.paramArr[_].split("=")[1]).blur(),"msg"==s.paramArr[_].split("=")[0]&&$(".account-prompt").html(decodeURI(s.paramArr[_].split("=")[1])).show()}(this.accountGuy);